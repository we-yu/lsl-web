version: '3.3'

services:
 web:
   container_name: "lsl-flask"
   build: ./flask
   tty: true
   volumes:
     - ./app:/app
   ports:
     - "5010:5001"
#   env_file: .env
   environment:
     VIRTUAL_HOST: lsl.mimizuku.dev
     LETSENCRYPT_HOST: lsl.mimizuku.dev
     LETSENCRYPT_EMAIL: whiterythronium@gmail.com
   depends_on:
     - mongo # for connection of mongoDB
   restart: always

 mariadb:
   image: mariadb:latest
   container_name: "lsl-mariadb"
   volumes:
     - ./mariadb:/var/lib/mysql
     - ./initdb.d:/docker-entrypoint-initdb.d
   ports:
     - "3326:3306"
   env_file: .env
#   environment:
#      - MYSQL_ROOT_PASSWORD=rootpasswd

 api:
   container_name: "lsl-api"
   build: ./node
   restart: unless-stopped
   volumes:
     - ./app/node:/app/node
   working_dir: /app/node
   ports:
     - "3021:3000"
   command: sh -c "npm install -g pm2 && npm install && pm2-runtime app.js --watch"

 phpmyadmin:
   image: phpmyadmin/phpmyadmin
   container_name: "lsl-mariadb-admin"
   links:
     - mariadb
   ports:
     - 8088:80
#   depends_on:
#     - mariadb
   volumes:
     - ./phpmyadmin/sessions:/sessions

 mongo:
   image: 'mongo:latest'
   container_name: "lsl-mongoDB"
#   env_file: .env
   environment:
    MONGO_INITDB_ROOT_USERNAME: mongoDBRoot
    MONGO_INITDB_ROOT_PASSWORD: mongoDBPasswd
   ports:
    - '27017:27017'
   volumes:
    - 'mongodb-data:/data/db'
#   command: mongod --port 27017

# mongodb:
#  container_name: "lsl-monbodb"
#  image: mongo
#  restart: always
#  environment:
#    MONGO_INITDB_ROOT_USERNAME: mongoDBRoot
#    MONGO_INITDB_ROOT_PASSWORD: mongoDBPasswd
#  ports:
#  - 27017:27017
#  volumes:
#  - ./mongo/db:/data/db
#  - ./mongo/configdb:/data/configdb

networks:
  default:
    external:
      name: common_link

volumes:
  mongodb-data: {}
